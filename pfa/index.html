<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PFA Tax Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f5f7fb;
            --card: #ffffff;
            --accent: #ffcd02;
            --accent-orange: #ff5714;
            --accent-yellow: #ffcd02;
            --muted: #6b7280;
            --radius: 12px;
            --max-width: 980px;
            --gap: 18px;
            --shadow: 0 4px 16px rgba(27, 231, 255, 0.08);
            --sans: "Quicksand", "Outfit", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: var(--sans);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.45;
            display: flex;
            justify-content: center;
        }

        .wrap {
            max-width: 600px;
            width: 100%;
            font-size: 16px;
            line-height: 1.45;
        }

        .header-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 32px;
            align-items: start;
        }

        h1 {
            font-size: 32px;
            margin: 0;
            color: #111111;
            letter-spacing: -0.03em;
            font-weight: 600;
        }

        .header-description {
            font-size: 16px;
            line-height: 1.6;
            color: #4a4a4a;
            font-weight: 600;
        }

        .calculator {
            border: 2px solid #1a1a1a;
            border-radius: 8px;
            background: linear-gradient(145deg, #4a4a4a, #3d3d3d);
            box-shadow:
                0 2px 1px rgba(255, 255, 255, 0.05) inset,
                0 -2px 1px rgba(0, 0, 0, 0.5) inset,
                0 8px 24px rgba(0, 0, 0, 0.6);
            padding: 12px;
        }

        .inputs-row {
            display: flex;
            gap: var(--gap);
            margin-bottom: 12px;
            padding: 24px;
            background: #2d2d2d;
        }

        .income-container,
        .tax-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tax-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .income-container p,
        .tax-container p {
            margin: 0 0 8px 0;
            font-weight: 600;
            font-size: 13px;
            color: #e8e8e8;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .calculations {
            padding: 24px;
            background: #2d2d2d;
        }

        .ti-row {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 6px 0;
            color: #e8e8e8;
        }

        .status-selector {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #454545;
        }

        .status-selector label {
            font-weight: 600;
            font-size: 13px;
            color: #e8e8e8;
            margin-right: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-selector select {
            padding: 8px 12px;
            border: 2px solid #0a0a0a;
            border-radius: 4px;
            font-size: 15px;
            font-weight: 600;
            background: #d4d2c0;
            color: #1a1a1a;
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.3) inset,
                0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .status-selector select:hover {
            border-color: var(--accent);
        }

        .status-selector select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(27, 231, 255, 0.15);
        }

        .deductions-row {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #454545;
        }

        .deductions-row>div:first-child {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: #e8e8e8;
        }

        .deduction {
            width: 150px;
            font-size: 20px;
            padding: 10px 14px;
            border: 2px solid #0a0a0a;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s ease;
            background: #d4d2c0;
            color: #1a1a1a;
            font-family: 'Courier New', monospace;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.3) inset,
                0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .income,
        .tax {
            width: 150px;
            font-size: 20px;
            padding: 10px 14px;
            border: 2px solid #0a0a0a;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s ease;
            background: #d4d2c0;
            color: #1a1a1a;
            font-family: 'Courier New', monospace;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.3) inset,
                0 1px 0 rgba(255, 255, 255, 0.1);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(255, 205, 2, 0.2);
            transform: translateY(-1px);
        }

        .bracket-range {
            flex: 1;
        }

        .taxed-value {
            width: 120px;
            text-align: right;
        }

        .rate {
            width: 60px;
            text-align: center;
        }

        .amount {
            width: 100px;
            text-align: right;
        }

        .tax-percentage {
            width: 100px;
            text-align: right;
            color: #e8e8e8;
        }

        .rate-strikethrough {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .share-buttons {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .share-label {
            color: #4a4a4a;
            font-size: 14px;
            font-weight: 600;
            margin-right: 4px;
        }

        .share-button {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        #share-bluesky {
            background: #1185fe;
            color: white;
        }

        #share-twitter {
            background: #000000;
            color: white;
        }

        #share-facebook {
            background: #1877f2;
            color: white;
        }

        .demo-box {
            background: #fff9e6;
            border: 2px solid #ffcd02;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
            position: relative;
        }

        .demo-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            font-size: 24px;
            color: #4a4a4a;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .demo-close:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .demo-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a4a4a;
            margin: 0 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .demo-row {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .demo-row:last-child {
            margin-bottom: 0;
        }

        .demo-row:hover {
            border-color: #ffcd02;
            background: #fffef8;
            transform: translateX(4px);
        }

        .demo-row-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .demo-income {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 15px;
        }

        .demo-status {
            font-weight: 400;
            color: #6b6b6b;
        }

        .demo-descriptor {
            font-weight: 400;
            color: #6b6b6b;
            font-size: 15px;
        }

        .demo-descriptor sup a {
            color: #6b6b6b;
            text-decoration: none;
            font-size: 10px;
        }

        .demo-descriptor sup a:hover {
            text-decoration: underline;
        }

        .demo-tax {
            color: #4a4a4a;
            font-size: 15px;
            font-weight: 500;
        }

        /* Mobile styles */
        @media (max-width: 640px) {
            body {
                padding: 16px;
            }

            .wrap {
                width: 100%;
            }

            .header-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                margin-bottom: 24px;
            }

            h1 {
                font-size: 24px;
            }

            .header-description {
                font-size: 14px;
            }

            .inputs-row {
                flex-direction: column;
                gap: 16px;
                padding: 16px;
            }

            .income-container,
            .tax-container {
                width: 100%;
            }

            .calculations {
                padding: 16px;
            }

            .ti-row {
                flex-wrap: wrap;
                gap: 8px;
            }

            .bracket-range {
                flex-basis: 100%;
                margin-bottom: 4px;
            }

            .taxed-value,
            .rate,
            .amount {
                flex: 1;
                min-width: 80px;
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="header-grid">
            <div>
                <h1>PFA Tax Calculator</h1>
            </div>
            <div class="header-description">
                Who's really paying the Preschool for All Tax? See for yourself.
            </div>
        </div>
        <div class="calculator">
            <div class="inputs-row">
                <div class="income-container">
                    <p>Income:</p>
                    <input class="income" type="text" id="income" name="income" value="50000" />

                </div>
                <div class="tax-container">
                    <p>County PFA Tax:</p>
                    <div class="tax-input-row">
                        <input class="tax" type="text" id="tax" name="tax" />
                        <div class="tax-percentage" id="tax-percentage"></div>
                    </div>
                </div>
            </div>
            <div class="calculations">
                <div class="status-selector">
                    <label for="filing-status">Filing status:</label>
                    <select id="filing-status" name="filing-status">
                        <option value="single">Single</option>
                        <option value="joint">Joint</option>
                        <option value="head">Head of Household</option>
                    </select>
                </div>
                <div class="deductions-row">
                    <div>
                        Deductions (<label for="standard">Standard</label> <input type="checkbox" id="standard"
                            name="standard" checked />):
                    </div>
                    <div>
                        <input class="deduction" type="text" id="deduction" name="deduction" />
                    </div>
                    <!-- when the box is checked, the input field is set to the right value. it's 2,835.00. for single, double that for joint and HoHH-->
                </div>
                <div class="ti-row">
                    <span class="bracket-range">Taxable income (TI):</span>
                    <span class="taxed-value" id="taxable-income-amount"></span>
                    <span class="rate"></span>
                    <span class="amount"></span>
                </div>
                <div class="ti-row">
                    <span class="bracket-range" id="bracket-1-range"></span>
                    <span class="taxed-value" id="bracket-1-taxed"></span>
                    <span class="rate" id="bracket-1-rate"></span>
                    <span class="amount" id="bracket-1-amount"></span>
                </div>
                <div class="ti-row">
                    <span class="bracket-range" id="bracket-2-range"></span>
                    <span class="taxed-value" id="bracket-2-taxed"></span>
                    <span class="rate" id="bracket-2-rate"></span>
                    <span class="amount" id="bracket-2-amount"></span>
                </div>
                <div class="ti-row" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #454545;">
                    <label for="tax-2027" style="cursor: pointer; display: flex; align-items: center; gap: 8px;" title="This tax increase was scheduled as part of the original ballot measure">
                        <input type="checkbox" id="tax-2027" name="tax-2027" />
                        <span>Recompute with voter-approved full tax rate (+0.8%)</span>
                    </label>
                </div>

            </div>
        </div>
        <div class="demo-box" id="demo-box">
            <button class="demo-close" id="demo-close" aria-label="Close demo">&times;</button>
            <div class="demo-title">Try these examples:</div>
            <div class="demo-row" data-income="32600" data-status="single" data-deductions="standard">
                <div class="demo-row-top">
                    <span class="demo-income">$32,600 <span class="demo-status">(Single)</span></span>
                    <span class="demo-tax">Tax: $0</span>
                </div>
                <div class="demo-descriptor">Full-time minimum wage worker in Portland<sup><a href="https://www.oregon.gov/boli/workers/Pages/minimum-wage.aspx" target="_blank">[1]</a></sup></div>
            </div>
            <div class="demo-row" data-income="86247" data-status="joint" data-deductions="standard">
                <div class="demo-row-top">
                    <span class="demo-income">$86,247 <span class="demo-status">(Joint)</span></span>
                    <span class="demo-tax">Tax: $0</span>
                </div>
                <div class="demo-descriptor">Median household income in Multnomah County (2023)<sup><a href="https://censusreporter.org/profiles/05000US41051-multnomah-county-or/" target="_blank">[2]</a></sup></div>
            </div>
            <div class="demo-row" data-income="127901.67" data-status="single" data-deductions="standard">
                <div class="demo-row-top">
                    <span class="demo-income">$127,901.67 <span class="demo-status">(Single)</span></span>
                    <span class="demo-tax">Tax: $1.00</span>
                </div>
                <div class="demo-descriptor">Estimated income of the top 10% of earners in Multnomah County <sup><a href="https://censusreporter.org/profiles/05000US41051-multnomah-county-or/?utm_source=chatgpt.com" target="_blank">[3]</a></sup></div>
            </div>
            <div class="demo-row" data-income="306960" data-status="joint" data-deductions="standard">
                <div class="demo-row-top">
                    <span class="demo-income">$306,960 <span class="demo-status">(Joint)</span></span>
                    <span class="demo-tax">Tax: $769.35</span>
                </div>
                <div class="demo-descriptor">Salary of Andrew Hoan, President of Portland Business Alliance<sup><a href="https://projects.propublica.org/nonprofits/organizations/320016048" target="_blank">[4]</a></sup></div>
            </div>
        </div>

        <div class="share-buttons">
            <span class="share-label">Share:</span>
            <a href="#" class="share-button" id="share-bluesky" aria-label="Share on Bluesky">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z"/>
                </svg>
            </a>
            <a href="#" class="share-button" id="share-twitter" aria-label="Share on Twitter">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="#" class="share-button" id="share-facebook" aria-label="Share on Facebook">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
            </a>
        </div>
    </div>
    <script>
        const filingStatus = document.getElementById('filing-status');
        const standardCheckbox = document.getElementById('standard');
        const deductionInput = document.getElementById('deduction');
        const incomeInput = document.getElementById('income');
        const taxInput = document.getElementById('tax');
        const taxPercentage = document.getElementById('tax-percentage');
        const taxableIncomeAmount = document.getElementById('taxable-income-amount');
        const bracket1Range = document.getElementById('bracket-1-range');
        const bracket1Taxed = document.getElementById('bracket-1-taxed');
        const bracket1Rate = document.getElementById('bracket-1-rate');
        const bracket1Amount = document.getElementById('bracket-1-amount');
        const bracket2Range = document.getElementById('bracket-2-range');
        const bracket2Taxed = document.getElementById('bracket-2-taxed');
        const bracket2Rate = document.getElementById('bracket-2-rate');
        const bracket2Amount = document.getElementById('bracket-2-amount');
        const tax2027Checkbox = document.getElementById('tax-2027');

        // Get current tax rates based on 2027 checkbox
        function getCurrentRates() {
            if (tax2027Checkbox.checked) {
                return {
                    bracket1: 0.023,  // 1.5% + 0.8% = 2.3%
                    bracket2: 0.038   // 3% + 0.8% = 3.8%
                };
            } else {
                return {
                    bracket1: 0.015,  // 1.5%
                    bracket2: 0.03    // 3%
                };
            }
        }

        // Update rate display
        function updateRateDisplay() {
            const rates = getCurrentRates();
            if (tax2027Checkbox.checked) {
                bracket1Rate.textContent = '× 2.3%';
                bracket2Rate.textContent = '× 3.8%';
            } else {
                bracket1Rate.textContent = '× 1.5%';
                bracket2Rate.textContent = '× 3%';
            }
        }

        // Helper functions for number formatting
        function parseNumberValue(value) {
            return parseFloat(String(value).replace(/,/g, '')) || 0;
        }

        function formatNumberInput(input) {
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            const numericValue = oldValue.replace(/[^0-9.]/g, '');

            if (numericValue === '') {
                input.value = '';
                return;
            }

            const parts = numericValue.split('.');
            parts[0] = parseInt(parts[0]).toLocaleString('en-US');
            const formattedValue = parts.join('.');

            input.value = formattedValue;

            // Adjust cursor position for added commas
            const addedCommas = formattedValue.length - oldValue.length;
            input.setSelectionRange(cursorPosition + addedCommas, cursorPosition + addedCommas);
        }

        // Handle standard deduction checkbox
        standardCheckbox.addEventListener('change', function () {
            if (this.checked) {
                const status = filingStatus.value;
                if (status === 'single') {
                    deductionInput.value = '2,835.00';
                } else if (status === 'joint') {
                    deductionInput.value = '5,670.00';
                } else {
                    deductionInput.value = '4,560.00';
                }
            } else {
                deductionInput.value = '0';
            }
            calculateTI();
        });

        // Update deduction when filing status changes
        filingStatus.addEventListener('change', function () {
            if (standardCheckbox.checked) {
                const status = filingStatus.value;
                if (status === 'single') {
                    deductionInput.value = '2,835.00';
                } else if (status === 'joint') {
                    deductionInput.value = '5,670.00';
                } else {
                    deductionInput.value = '4,560.00';
                }
            }
            calculateTI();
        });

        // Format inputs as user types
        incomeInput.addEventListener('input', function () {
            const value = parseNumberValue(incomeInput.value);
            if (value !== 0) {
                formatNumberInput(incomeInput);
            }
            calculateTI();
        });

        deductionInput.addEventListener('input', function () {
            const value = parseNumberValue(deductionInput.value);
            if (value !== 0) {
                formatNumberInput(deductionInput);
            }
            standardCheckbox.checked = false;
            calculateTI();
        });

        // Calculate income from tax (reverse calculation)
        taxInput.addEventListener('input', function () {
            const value = parseNumberValue(taxInput.value);
            if (value !== 0) {
                formatNumberInput(taxInput);
            }
            const targetTax = parseNumberValue(taxInput.value);
            const deduction = parseNumberValue(deductionInput.value);
            const status = filingStatus.value;

            // If tax is 0, set income to default
            if (targetTax === 0) {
                incomeInput.value = '50,000';
                calculateTI(false);
                return;
            }

            // Get current rates
            const rates = getCurrentRates();

            // Define brackets based on filing status
            const bracket1Lower = status === 'single' ? 125000 : 250000;
            const bracket1Upper = status === 'single' ? 200000 : 400000;
            const bracket1MaxTax = (bracket1Upper - bracket1Lower) * rates.bracket1;

            let taxableIncome;
            if (targetTax <= bracket1MaxTax) {
                // Tax is entirely in bracket 1
                taxableIncome = bracket1Lower + (targetTax / rates.bracket1);
            } else {
                // Tax spans into bracket 2
                const bracket2Tax = targetTax - bracket1MaxTax;
                const bracket2TaxableAmount = bracket2Tax / rates.bracket2;
                taxableIncome = bracket1Upper + bracket2TaxableAmount;
            }

            const income = taxableIncome + deduction;
            incomeInput.value = income.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            calculateTI(false);
        });

        function calculateTI(updateTax = true) {
            const income = parseNumberValue(incomeInput.value);
            const deduction = parseNumberValue(deductionInput.value);
            const taxableIncome = Math.max(income - deduction, 0);
            const status = filingStatus.value;

            // Get current rates
            const rates = getCurrentRates();

            // Display taxable income
            taxableIncomeAmount.textContent = `$${taxableIncome.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            // Define brackets based on filing status
            const bracket1Lower = status === 'single' ? 125000 : 250000;
            const bracket1Upper = status === 'single' ? 200000 : 400000;

            // Calculate bracket 1 (between bracket1Lower and bracket1Upper)
            const bracket1TaxableAmount = Math.max(0, Math.min(taxableIncome, bracket1Upper) - bracket1Lower);
            const bracket1Tax = bracket1TaxableAmount * rates.bracket1;
            bracket1Range.textContent = `TI $${bracket1Lower.toLocaleString('en-US')}-$${bracket1Upper.toLocaleString('en-US')}:`;
            bracket1Taxed.textContent = `$${bracket1TaxableAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            bracket1Amount.textContent = `$${bracket1Tax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            // Calculate bracket 2 (above bracket1Upper)
            const bracket2TaxableAmount = Math.max(0, taxableIncome - bracket1Upper);
            const bracket2Tax = bracket2TaxableAmount * rates.bracket2;
            bracket2Range.textContent = `TI above $${bracket1Upper.toLocaleString('en-US')}:`;
            bracket2Taxed.textContent = `$${bracket2TaxableAmount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            bracket2Amount.textContent = `$${bracket2Tax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            // Update rate display
            updateRateDisplay();

            // Update total tax
            if (updateTax) {
                const totalTax = bracket1Tax + bracket2Tax;
                taxInput.value = totalTax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }

            // Update effective tax percentage
            const currentTax = parseNumberValue(taxInput.value);
            if (income > 0) {
                const effectivePercentage = (currentTax / income) * 100;
                taxPercentage.textContent = "= " + effectivePercentage.toFixed(2) + '%';
            } else {
                taxPercentage.textContent = "= 0%";
            }
        }

        // Handle 2027 tax checkbox
        tax2027Checkbox.addEventListener('change', function () {
            calculateTI();
            updateDemoTaxes();
        });

        // Initialize on page load
        // Check for query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const incomeParam = urlParams.get('income');
        const statusParam = urlParams.get('status');
        const deductionsParam = urlParams.get('deductions');

        // Set filing status from query param
        if (statusParam) {
            const validStatuses = ['single', 'joint', 'head'];
            if (validStatuses.includes(statusParam.toLowerCase())) {
                filingStatus.value = statusParam.toLowerCase();
            }
        }

        // Set income from query param
        if (incomeParam) {
            incomeInput.value = incomeParam;
            formatNumberInput(incomeInput);
        } else {
            formatNumberInput(incomeInput);
        }

        // Set deductions from query param
        if (deductionsParam) {
            if (deductionsParam.toLowerCase() === 'standard') {
                standardCheckbox.checked = true;
                const status = filingStatus.value;
                if (status === 'single') {
                    deductionInput.value = '2,835.00';
                } else if (status === 'joint') {
                    deductionInput.value = '5,670.00';
                } else {
                    deductionInput.value = '4,560.00';
                }
            } else {
                // Try to parse as numeric value
                const deductionValue = parseNumberValue(deductionsParam);
                deductionInput.value = deductionValue.toString();
                formatNumberInput(deductionInput);
                standardCheckbox.checked = false;
            }
        } else if (incomeParam) {
            // If income param is set but no deductions param, set to 0
            deductionInput.value = '0';
            standardCheckbox.checked = false;
        } else {
            // Default behavior - use standard deduction
            if (standardCheckbox.checked) {
                deductionInput.value = '2,835.00';
            }
        }

        calculateTI();
        incomeInput.focus();

        // Calculate tax for demo examples
        function calculateDemoTax(income, status, deductionsType) {
            // Get deduction amount
            let deduction;
            if (deductionsType === 'standard') {
                if (status === 'single') {
                    deduction = 2835.00;
                } else if (status === 'joint') {
                    deduction = 5670.00;
                } else {
                    deduction = 4560.00;
                }
            } else {
                deduction = parseFloat(deductionsType) || 0;
            }

            const taxableIncome = Math.max(income - deduction, 0);
            const rates = getCurrentRates();

            // Define brackets based on filing status
            const bracket1Lower = status === 'single' ? 125000 : 250000;
            const bracket1Upper = status === 'single' ? 200000 : 400000;

            // Calculate bracket 1
            const bracket1TaxableAmount = Math.max(0, Math.min(taxableIncome, bracket1Upper) - bracket1Lower);
            const bracket1Tax = bracket1TaxableAmount * rates.bracket1;

            // Calculate bracket 2
            const bracket2TaxableAmount = Math.max(0, taxableIncome - bracket1Upper);
            const bracket2Tax = bracket2TaxableAmount * rates.bracket2;

            return bracket1Tax + bracket2Tax;
        }

        // Update demo tax amounts
        function updateDemoTaxes() {
            const demoRows = document.querySelectorAll('.demo-row');
            demoRows.forEach(row => {
                const income = parseFloat(row.getAttribute('data-income'));
                const status = row.getAttribute('data-status');
                const deductions = row.getAttribute('data-deductions');

                const tax = calculateDemoTax(income, status, deductions);
                const taxSpan = row.querySelector('.demo-tax');
                taxSpan.textContent = `Tax: $${tax.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            });
        }

        // Demo box functionality
        const demoBox = document.getElementById('demo-box');
        const demoClose = document.getElementById('demo-close');
        const demoRows = document.querySelectorAll('.demo-row');

        demoClose.addEventListener('click', function() {
            demoBox.style.display = 'none';
        });

        demoRows.forEach(row => {
            row.addEventListener('click', function() {
                const income = this.getAttribute('data-income');
                const status = this.getAttribute('data-status');
                const deductions = this.getAttribute('data-deductions');

                // Set income
                incomeInput.value = income;
                formatNumberInput(incomeInput);

                // Set filing status
                if (status) {
                    filingStatus.value = status;
                }

                // Set deductions
                if (deductions === 'standard') {
                    standardCheckbox.checked = true;
                    if (status === 'single') {
                        deductionInput.value = '2,835.00';
                    } else if (status === 'joint') {
                        deductionInput.value = '5,670.00';
                    } else {
                        deductionInput.value = '4,560.00';
                    }
                } else {
                    standardCheckbox.checked = false;
                    deductionInput.value = deductions;
                    formatNumberInput(deductionInput);
                }

                calculateTI();
                incomeInput.focus({ preventScroll: true });

                // Smooth scroll to top
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });

        // Initialize demo taxes
        updateDemoTaxes();

        // Share button functionality
        const shareBluesky = document.getElementById('share-bluesky');
        const shareTwitter = document.getElementById('share-twitter');
        const shareFacebook = document.getElementById('share-facebook');

        function getShareUrl() {
            const income = parseNumberValue(incomeInput.value);
            const status = filingStatus.value;
            const deductions = standardCheckbox.checked ? 'standard' : parseNumberValue(deductionInput.value);
            return `https://friendsofpfa.org/pfa-tax-calculator/?income=${income}&status=${status}&deductions=${deductions}`;
        }

        shareBluesky.addEventListener('click', function(e) {
            e.preventDefault();
            const url = getShareUrl();
            const text = 'Check out this Preschool For All Tax Calculator';
            window.open(`https://bsky.app/intent/compose?text=${encodeURIComponent(text + ' ' + url)}`, '_blank');
        });[DynamoDB-section]

        shareTwitter.addEventListener('click', function(e) {
            e.preventDefault();
            const url = getShareUrl();
            const text = 'Check out this Preschool For All Tax Calculator';
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
        });

        shareFacebook.addEventListener('click', function(e) {
            e.preventDefault();
            const url = getShareUrl();
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        });
    </script>
</body>

</html>